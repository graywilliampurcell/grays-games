<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Escape — Map Generation Tests</title>
  <style>
    body { font-family: system-ui, Arial; background:#111; color:#eee; padding:16px }
    .controls { margin-bottom:12px }
    label { margin-right:8px }
    .maze { margin-top:12px; line-height:0; }
    .cell { width:16px; height:16px; display:inline-block; box-sizing:border-box; }
    .wall { background:#444; }
    .empty { background:#222; border:1px solid #333; }
    .exit { background:#0a0; }
    .secret { background:#a33; }
    .trap { background:#a60; }
    pre { background:#000; color:#0f0; padding:8px; overflow:auto }
    .pass { color:#8f8 } .fail { color:#f88 }
    .test-result { margin-top:8px }
  </style>
</head>
<body>
  <h1>Map generation — test harness</h1>
  <div class="controls">
    <label>Width: <input id="w" type="number" value="21" min="3" step="2"></label>
    <label>Height: <input id="h" type="number" value="21" min="3" step="2"></label>
    <label>Secret doors: <input id="num-secret" type="number" value="2" min="0" max="10"></label>
    <label>Trap doors: <input id="num-trap" type="number" value="2" min="0" max="10"></label>
    <button id="gen">Generate Maze</button>
    <button id="run-tests">Run Tests</button>
  </div>

  <div id="info"></div>
  <div id="legend" style="margin-top:8px; font-size:0.9em; color:#ddd">
    <!-- legend populated by test.js -->
  </div>
  <div id="maze" class="maze"></div>
  <pre id="grid"></pre>
  <div id="results" class="test-result"></div>

  <!-- load the app code first, then the test harness -->
  <script src="../main.js"></script>
  <script src="../lib/util.js"></script>

  <!-- Seed UI: displays current seed and allows loading a seed to reproduce a map -->
  <div style="width:90%;max-width:600px;margin:12px auto 0;text-align:left;">
    <div style="font-size:13px;margin-bottom:6px;color:#ddd;">Seed (copy to reproduce exact map):</div>
    <textarea id="seed" rows="2" style="width:100%;box-sizing:border-box;padding:6px;border-radius:4px;border:1px solid #444;background:#111;color:#fff;"></textarea>
    <div style="margin-top:6px;text-align:right;">
      <button id="load-seed-btn">Load Seed</button>
    </div>
  </div>

  <script src="test.js"></script>
  <script>
    // wire the load seed button to util's seed decoder (if available) and the test renderer
    (function(){
      const loadBtn = document.getElementById('load-seed-btn');
      if (!loadBtn) return;
      loadBtn.addEventListener('click', () => {
        const s = document.getElementById('seed').value.trim();
        let m = null;
        if (window.seedToMaze) {
          m = window.seedToMaze(s);
        } else {
          // fallback decoder (v1 base64 JSON)
          try {
            if (s.indexOf('v1:') === 0) {
              m = JSON.parse(decodeURIComponent(escape(atob(s.slice(3)))));
            }
          } catch (e) { m = null; }
        }
        if (!m) {
          const info = document.getElementById('info');
          if (info) info.textContent = 'Invalid seed';
          return;
        }
        // render using test harness renderer
        if (typeof renderMaze === 'function') {
          renderMaze(m);
          const info = document.getElementById('info');
          if (info) info.textContent = `Loaded seed — maze ${m[0].length} x ${m.length}`;
        }
      });
    })();
  </script>
</body>
</html>
